# Prompt de Continuidade - Sess√£o #12

**Framework de Intelig√™ncia Territorial V6.0**  
**Data de Cria√ß√£o:** 01/12/2025  
**Sess√£o Anterior:** #11 - Replica√ß√£o e Valida√ß√£o do N√∫cleo de 4 Especialistas

---

## üéØ CONTEXTO PARA A PR√ìXIMA SESS√ÉO

Ol√°, **voc√™ do futuro**! üëã

Se voc√™ est√° lendo isso, √© porque est√° prestes a dar continuidade a um dos projetos mais ambiciosos e transformadores que voc√™ j√° iniciou: o **Framework de Intelig√™ncia Territorial V6.0**.

Na **Sess√£o #11**, alcan√ßamos um marco hist√≥rico: **o MVP est√° 100% completo!** O n√∫cleo de 4 especialistas (ECON, SOCIAL, TERRA, AMBIENT) foi criado, testado e validado em um ambiente de produ√ß√£o real (n8n Cloud). Cada agente executou com sucesso o ciclo completo de 4 camadas RAG, gerando an√°lises multidimensionais, registrando aprendizados e atualizando sua expertise. A metodologia de replica√ß√£o baseada em "template + script" se provou altamente eficaz, permitindo criar novos agentes em minutos.

Agora temos um **n√∫cleo de especialistas funcional**, mas ainda precisamos do **c√©rebro do sistema**: o **Agente Orquestrador**.

---

## üåü O QUE VOC√ä CONQUISTOU NA SESS√ÉO #11

- ‚úÖ **N√∫cleo de 4 Especialistas Completo** (ECON, SOCIAL, TERRA, AMBIENT)
- ‚úÖ **Todos os Agentes Validados em Produ√ß√£o** (n8n Cloud)
- ‚úÖ **Ciclo de Aprendizagem de 4 Camadas** funcionando para todos os agentes
- ‚úÖ **Metodologia de Replica√ß√£o Consolidada** (template + script)
- ‚úÖ **Decis√£o de Design de Arquitetura** (separa√ß√£o de responsabilidades)
- ‚úÖ **4 An√°lises Geradas** (1 por agente) e **7 Aprendizados Registrados**
- ‚úÖ **Documenta√ß√£o Abrangente** (di√°rio, roadmap, estado do projeto)
- ‚úÖ **MVP em 100%** de conclus√£o

---

## üìö DOCUMENTA√á√ÉO ESSENCIAL

Antes de prosseguir, **leia estes documentos** no reposit√≥rio GitHub para absorver o contexto completo:

### Documentos Chave

1. **README.md** (Vis√£o Geral do Projeto - **Atualizado na Sess√£o #11**)  
   üìç `/README.md`

2. **INDEX.md** (√çndice Master da Documenta√ß√£o)  
   üìç `/docs/INDEX.md`

3. **VISION.md** (Vis√£o Estrat√©gica - **Atualizado na Sess√£o #11**)  
   üìç `/VISION.md`

4. **Estado Atual do Projeto** (**Atualizado na Sess√£o #11**)  
   üìç `/docs/ESTADO_PROJETO_FIM_SESSAO.md`

5. **Arquitetura do N√∫cleo de Especialistas**  
   üìç `/docs/n8n/ARQUITETURA_NUCLEO_ESPECIALISTAS.md`

### Di√°rios das √öltimas Sess√µes

6. **Di√°rio de Pesquisa-A√ß√£o (Sess√£o #11)** (**Novo!**)  
   üìç `/docs/diarios/SESSAO_11_DIARIO_PESQUISA_ACAO.md`

7. **Di√°rio de Pesquisa-A√ß√£o (Sess√£o #10)**  
   üìç `/docs/diarios/SESSAO_2025-11-30_ECON_RAG_COMPLETO.md`

8. **Relat√≥rio Final da Sess√£o #10**  
   üìç `/relatorio_final_workflow_econ.md`

### Documentos de Implementa√ß√£o da Sess√£o #11

9. **Entrega Consolidada da Sess√£o #11** (**Novo!**)  
   üìç `/docs/ENTREGA_SESSAO_11_TRES_AGENTES.md`

10. **Schema Real Validado** (**Novo!**)  
    üìç `/docs/SCHEMA_REAL_AGENTES.md`

11. **Estrat√©gia de Replica√ß√£o** (**Novo!**)  
    üìç `/docs/ESTRATEGIA_REPLICACAO_AGENTES.md`

12. **Roadmap de Tipos de An√°lise** (**Novo!**)  
    üìç `/docs/roadmap/DESENVOLVIMENTO_FUTURO_TIPOS_ANALISE.md`

### Workflows Funcionais (Templates para Refer√™ncia)

13. **Workflow do Agente SOCIAL V6.1** (**Validado!**)  
    üìç `/WF-AGENT-SOCIAL-V6.1-CORRIGIDO.json`

14. **Workflow do Agente TERRA V6.1** (**Validado!**)  
    üìç `/WF-AGENT-TERRA-V6.1-MULTIDIMENSIONAL.json`

15. **Workflow do Agente AMBIENT V6.1** (**Validado!**)  
    üìç `/WF-AGENT-AMBIENT-V6.1-MULTIDIMENSIONAL.json`

16. **Workflow do Agente ECON V6.1** (**Template Original**)  
    üìç `/n8n/workflows/WF-AGENT-ECON-EspecialistaEcon√¥micoV6.1(Multidimensional).json`

---

## üõ†Ô∏è ATIVOS EXISTENTES (CHECKLIST DE CONTEXTO)

Verifique o status e a localiza√ß√£o dos seguintes ativos:

### 1. Aplicativo Web (Replit)
- **URL:** [https://inteligencia-territorial--hrhenrique7.replit.app](https://inteligencia-territorial--hrhenrique7.replit.app)
- **Estrutura:** `client/` (frontend), `server/` (backend), `shared/` (schemas)
- **Integra√ß√£o:** Sincronizado com a branch `main` do GitHub
- **Status:** ‚úÖ Ativo e operacional

### 2. Banco de Dados (Neon)
- **Status:** ‚úÖ Em produ√ß√£o com 4 an√°lises e 7 aprendizados
- **Estrutura:** 4 camadas RAG, 22 tabelas, 4.089 indicadores
- **Credenciais:** Fornecidas separadamente pelo usu√°rio
- **Tabelas por Agente:**
  - ‚úÖ **ECON:** `agent_econ_memory`, `agent_econ_learning_evolution` (4 aprendizados)
  - ‚úÖ **SOCIAL:** `agent_social_memory`, `agent_social_learning_evolution` (1 aprendizado)
  - ‚úÖ **TERRA:** `agent_terra_memory`, `agent_terra_learning_evolution` (1 aprendizado)
  - ‚úÖ **AMBIENT:** `agent_ambient_memory`, `agent_ambient_learning_evolution` (1 aprendizado)

### 3. Workflows (n8n Cloud)
- **Agente ECON V6.1:** ‚úÖ **100% Funcional e Validado**
- **Agente SOCIAL V6.1:** ‚úÖ **100% Funcional e Validado**
- **Agente TERRA V6.1:** ‚úÖ **100% Funcional e Validado**
- **Agente AMBIENT V6.1:** ‚úÖ **100% Funcional e Validado**
- **Orquestrador:** ‚è≥ **Aguardando implementa√ß√£o (Sess√£o #12)**

### 4. Scripts e Ferramentas de Valida√ß√£o
- **Valida√ß√£o de Schema:** Script Python para extrair e validar schema real do banco
- **Testes de Workflows:** Scripts para enviar POSTs e verificar salvamento no banco
- **Replica√ß√£o de Workflows:** Scripts para gerar novos workflows a partir de templates

### 5. Scripts de Coleta
- **Dispon√≠veis:** `scripts/data_collection/`
- **Status:** Prontos para uso, dados reais populados no banco

---

## üöÄ PR√ìXIMA FRONTEIRA: SESS√ÉO #12

### Objetivo da Sess√£o #12

**Projetar, implementar e testar a primeira vers√£o do Agente Orquestrador, respons√°vel por receber requisi√ß√µes do usu√°rio, normalizar entradas e rotear para o especialista correto.**

### Por Que o Orquestrador √© Cr√≠tico?

Atualmente, precisamos chamar cada agente por seu webhook espec√≠fico (`/webhook/agent-social`, `/webhook/agent-terra`, etc.) com um payload perfeitamente formatado contendo 4 campos obrigat√≥rios:
- `agent_id`
- `territory_id`
- `territory_name`
- `analysis_type`

Isso √© √≥timo para testes, mas **invi√°vel para um produto real**. O Orquestrador ir√°:

1. **Abstrair a Complexidade:** Permitir que os usu√°rios fa√ßam perguntas de forma natural, sem precisar saber qual especialista deve responder.
2. **Normalizar Entradas:** Definir valores padr√£o para campos opcionais (`analysis_type = "comprehensive"`).
3. **Enriquecer Dados:** Buscar `territory_name` no banco se n√£o for fornecido.
4. **Rotear Inteligentemente:** Decidir qual especialista deve responder com base no contexto da pergunta.

**Sem o Orquestrador, temos um time de especialistas. Com o Orquestrador, temos um sistema de intelig√™ncia coeso.**

---

## üìã TAREFAS DA SESS√ÉO #12

| Tarefa | Descri√ß√£o | Crit√©rios de Conclus√£o |
|---|---|---|
| **Design do Agente Orquestrador** (Prioridade #1) | Definir a l√≥gica de roteamento (palavras-chave, LLM classificador, etc.) e projetar o workflow no n8n. | Diagrama de fluxo e especifica√ß√£o t√©cnica completos |
| **Implementa√ß√£o do Workflow** (Prioridade #2) | Criar o workflow no n8n com os n√≥s de Webhook, Valida√ß√£o, Normaliza√ß√£o, Roteamento e Chamada de Sub-workflow. | Workflow criado e ativo no n8n Cloud |
| **Implementa√ß√£o da Normaliza√ß√£o** (Prioridade #3) | Adicionar a l√≥gica para definir `analysis_type` padr√£o e enriquecer `territory_name` se necess√°rio. | Normaliza√ß√£o funcionando corretamente |
| **Testes de Roteamento** (Prioridade #4) | Enviar POSTs com diferentes perguntas e validar se o Orquestrador chama o especialista correto. | 100% de acerto no roteamento |
| **Testes do Fluxo Completo** (Prioridade #5) | Fazer uma requisi√ß√£o ao Orquestrador e validar se a an√°lise √© gerada e salva corretamente pelo especialista. | Ciclo completo funcionando (Orquestrador ‚Üí Especialista ‚Üí Banco) |
| **Documenta√ß√£o** (Prioridade #6) | Documentar o Agente Orquestrador e atualizar o estado do projeto. | Documenta√ß√£o completa e estado atualizado |

---

## üí° INSTRU√á√ïES PARA O MANUS AI

Ao iniciar a Sess√£o #12, siga este protocolo:

1. **Conecte ao GitHub:**
   ```bash
   gh repo clone henrique-m-ribeiro/framework-v6-mvp
   ```

2. **Leia os documentos essenciais** listados acima, com aten√ß√£o especial para:
   - O di√°rio da Sess√£o #11 (para entender as decis√µes de design)
   - O estado atual do projeto (para ver o plano detalhado)
   - O roadmap de tipos de an√°lise (para entender a l√≥gica futura do `analysis_type`)

3. **Verifique o schema das tabelas** `territories` no banco Neon para entender como enriquecer `territory_name`.

4. **Confirme o entendimento** com o usu√°rio antes de prosseguir.

5. **Solicite as credenciais do n8n** ao usu√°rio para iniciar a implementa√ß√£o.

6. **Projete o workflow do Orquestrador** e valide o design com o usu√°rio antes de implementar.

7. **Implemente o workflow** no n8n Cloud.

8. **Teste o roteamento** com diferentes perguntas.

9. **Teste o fluxo completo** e valide o salvamento no banco.

10. **Registre a sess√£o** no di√°rio de pesquisa-a√ß√£o ao final.

---

## üî• POR QUE ESTE PROJETO √â ESPECIAL

Este n√£o √© apenas mais um projeto de IA. √â um projeto que:

- **Democratiza intelig√™ncia territorial** para pequenos munic√≠pios
- **Materializa a vis√£o de agentes que evoluem** como especialistas humanos
- **Combina rigor acad√™mico** com **pragmatismo de startup**
- **Documenta reflexivamente** cada passo, criando conhecimento reutiliz√°vel
- **Co-evolui humano-IA** de forma genu√≠na

**Voc√™ est√° construindo o futuro da gest√£o p√∫blica inteligente.** üöÄ

---

## üéØ CONTEXTO T√âCNICO CR√çTICO

### Aprendizados das Sess√µes #10 e #11

- **Valida√ß√£o Contra Schema Real:** Sempre valide queries SQL contra o schema real do banco de dados, n√£o contra documenta√ß√£o desatualizada.
- **Separa√ß√£o de Responsabilidades:** Agentes especializados devem manter valida√ß√µes rigorosas. O Orquestrador √© respons√°vel por normalizar entradas e definir valores padr√£o.
- **Metodologia de Replica√ß√£o:** Use um workflow "template" e scripts de automa√ß√£o para criar novos agentes de forma eficiente e consistente.
- **Testes Iterativos:** Teste cada componente individualmente antes de testar o fluxo completo.
- **Colabora√ß√£o Humano-IA:** A depura√ß√£o √© mais eficaz quando o humano fornece contexto preciso (logs, screenshots) e a IA analisa e prop√µe solu√ß√µes.

### Estrutura do Payload de Entrada (Especialistas)

Os agentes especializados esperam um payload com **4 campos obrigat√≥rios**:

```json
{
  "agent_id": "social",
  "territory_id": "1721000",
  "territory_name": "Palmas",
  "analysis_type": "comprehensive"
}
```

### Responsabilidades do Orquestrador

1. **Receber Requisi√ß√£o do Usu√°rio:**
   - Payload m√≠nimo: `{"territory_id": "1721000", "question": "Como est√° a economia de Palmas?"}`

2. **Validar Entrada:**
   - Verificar se `territory_id` foi fornecido (obrigat√≥rio).

3. **Normalizar Dados:**
   - Definir `analysis_type = "comprehensive"` se n√£o fornecido.
   - Buscar `territory_name` no banco se n√£o fornecido.

4. **Rotear para o Especialista:**
   - Analisar a `question` e decidir qual especialista deve responder.
   - Op√ß√µes de roteamento:
     - **Palavras-chave:** Buscar termos como "economia", "social", "urbaniza√ß√£o", "meio ambiente".
     - **LLM Classificador:** Usar um LLM para classificar a pergunta em uma das 4 dimens√µes.
     - **H√≠brido:** Combinar palavras-chave com LLM para maior precis√£o.

5. **Chamar o Especialista:**
   - Enviar POST para o webhook do especialista correto com o payload normalizado.

6. **Retornar Resposta:**
   - Aguardar a resposta do especialista e retorn√°-la ao usu√°rio.

---

## üéØ ESTRAT√âGIA DE IMPLEMENTA√á√ÉO

### Fase 1: Design do Agente Orquestrador (1h)

1. **Definir a L√≥gica de Roteamento:**
   - Decidir entre palavras-chave, LLM classificador ou h√≠brido.
   - Criar uma tabela de mapeamento de termos para dimens√µes.

2. **Projetar o Workflow no n8n:**
   - Desenhar os n√≥s necess√°rios:
     - **Webhook:** Recebe requisi√ß√£o do usu√°rio.
     - **Validar Entrada:** Verifica se `territory_id` foi fornecido.
     - **Normalizar Dados:** Define valores padr√£o e enriquece dados.
     - **Rotear:** Decide qual especialista chamar.
     - **Chamar Especialista:** Envia POST para o webhook do especialista.
     - **Responder:** Retorna a resposta ao usu√°rio.

3. **Definir o Contrato de Dados:**
   - **Entrada:** `{"territory_id": "1721000", "question": "Como est√° a economia?", "analysis_type": "comprehensive" (opcional)}`
   - **Sa√≠da:** Resposta do especialista (an√°lise gerada).

### Fase 2: Implementa√ß√£o (1.5h)

4. **Criar o Workflow no n8n:**
   - Implementar o webhook de entrada (`/webhook/orchestrator`).
   - Escrever o c√≥digo do n√≥ de roteamento (JavaScript ou Python).
   - Configurar os n√≥s de chamada aos workflows dos especialistas (HTTP Request).

5. **Implementar a Normaliza√ß√£o:**
   - Adicionar a l√≥gica para definir `analysis_type` como `comprehensive` por padr√£o.
   - Consultar a tabela `territories` para enriquecer `territory_name` se n√£o for fornecido.

### Fase 3: Testes (1h)

6. **Testar o Roteamento:**
   - Enviar POSTs com diferentes perguntas:
     - "Como est√° a economia de Palmas?" ‚Üí ECON
     - "Qual o IDH de Palmas?" ‚Üí SOCIAL
     - "Como est√° a urbaniza√ß√£o de Palmas?" ‚Üí TERRA
     - "Qual o n√≠vel de desmatamento em Palmas?" ‚Üí AMBIENT
   - Verificar se o Orquestrador chama o especialista correto.

7. **Testar a Normaliza√ß√£o:**
   - Enviar um POST sem `analysis_type` e verificar se o valor padr√£o √© adicionado.
   - Enviar um POST sem `territory_name` e verificar se √© enriquecido.

8. **Testar o Fluxo Completo:**
   - Fazer uma requisi√ß√£o ao Orquestrador e validar se a an√°lise √© gerada e salva corretamente no banco de dados pelo especialista.

### Fase 4: Documenta√ß√£o (30 min)

9. **Documentar o Agente Orquestrador:**
   - Criar um documento explicando sua fun√ß√£o, l√≥gica e como us√°-lo.

10. **Atualizar o Estado do Projeto e Criar Prompt para Sess√£o #13.**

---

## üîß PEND√äNCIAS IDENTIFICADAS (SESS√ÉO #11)

### Importantes (N√£o Bloqueia)

1. **Corrigir campo `generated_by`:**
   - Atualmente, todos os agentes salvam como "WF-AGENT-ECON".
   - √â necess√°rio parametrizar este campo em cada workflow.

2. **Padronizar `dimension`:**
   - Agente TERRA salva como `terra` em vez de `territorial`.
   - √â preciso padronizar a nomenclatura em todos os workflows.

### Opcionais (Melhorias Futuras)

3. **Implementar tipos de an√°lise diferenciados:**
   - Quick, Focused, Comparative.
   - Roadmap completo criado em `docs/roadmap/DESENVOLVIMENTO_FUTURO_TIPOS_ANALISE.md`.

---

**Preparado por:** Manus AI  
**Data:** 01/12/2025  
**Reposit√≥rio:** [framework-v6-mvp](https://github.com/henrique-m-ribeiro/framework-v6-mvp)
