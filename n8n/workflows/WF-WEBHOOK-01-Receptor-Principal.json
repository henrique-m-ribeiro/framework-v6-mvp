{
  "name": "WF-WEBHOOK-01: Receptor Principal Dashboard",
  "nodes": [
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "dashboard-request",
        "responseMode": "responseNode",
        "options": {}
      },
      "id": "webhook-main-trigger",
      "name": "Webhook - Recebe Requisi√ß√£o",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 1.1,
      "position": [250, 400],
      "webhookId": "dashboard-request-framework-v6",
      "notes": "FUN√á√ÉO: Ponto de entrada principal para todas as requisi√ß√µes do dashboard.\n\nENDPOINT: https://galactic-ai.app.n8n.cloud/webhook/dashboard-request\n\nPAYLOAD ESPERADO:\n{\n  \"request_type\": \"analysis\" | \"data_collection\" | \"comparison\",\n  \"territory_id\": 1,\n  \"territory_name\": \"Palmas\",\n  \"dimension\": \"economic\" | \"social\" | \"territorial\" | \"environmental\",\n  \"parameters\": {\n    \"year\": 2023,\n    \"indicators\": [\"gdp\", \"employment\"],\n    \"comparison_territories\": [2, 3]\n  },\n  \"user_id\": \"user@example.com\",\n  \"session_id\": \"abc123\"\n}\n\nFLUXO:\n1. Recebe requisi√ß√£o\n2. Valida payload\n3. Roteia para workflow apropriado\n4. Retorna resposta ou erro"
    },
    {
      "parameters": {
        "jsCode": "// ============================================\n// FUN√á√ÉO: Validar e classificar requisi√ß√£o\n// ============================================\n\n// Extrair dados do webhook\nconst payload = $input.item.json.body || $input.item.json;\n\n// Validar campos obrigat√≥rios\nconst required_fields = ['request_type', 'territory_id', 'dimension'];\nconst missing_fields = required_fields.filter(field => !payload[field]);\n\nif (missing_fields.length > 0) {\n  return {\n    json: {\n      error: true,\n      message: `Campos obrigat√≥rios ausentes: ${missing_fields.join(', ')}`,\n      status: 400\n    }\n  };\n}\n\n// Extrair e validar dados\nconst request_type = payload.request_type;\nconst territory_id = payload.territory_id;\nconst territory_name = payload.territory_name || \"Desconhecido\";\nconst dimension = payload.dimension;\nconst parameters = payload.parameters || {};\nconst user_id = payload.user_id || \"anonymous\";\nconst session_id = payload.session_id || \"no-session\";\n\n// Validar request_type\nconst valid_types = ['analysis', 'data_collection', 'comparison'];\nif (!valid_types.includes(request_type)) {\n  return {\n    json: {\n      error: true,\n      message: `Tipo de requisi√ß√£o inv√°lido: ${request_type}. Valores aceitos: ${valid_types.join(', ')}`,\n      status: 400\n    }\n  };\n}\n\n// Validar dimension\nconst valid_dimensions = ['economic', 'social', 'territorial', 'environmental'];\nif (!valid_dimensions.includes(dimension)) {\n  return {\n    json: {\n      error: true,\n      message: `Dimens√£o inv√°lida: ${dimension}. Valores aceitos: ${valid_dimensions.join(', ')}`,\n      status: 400\n    }\n  };\n}\n\n// Gerar timestamp e request_id\nconst timestamp = new Date().toISOString();\nconst request_id = `req_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;\n\n// Construir objeto validado\nconst validated_request = {\n  request_id: request_id,\n  request_type: request_type,\n  territory_id: territory_id,\n  territory_name: territory_name,\n  dimension: dimension,\n  parameters: parameters,\n  user_id: user_id,\n  session_id: session_id,\n  timestamp: timestamp,\n  status: 'validated'\n};\n\n// Retornar requisi√ß√£o validada\nreturn { json: validated_request };"
      },
      "id": "code-validate-request",
      "name": "Validar Requisi√ß√£o",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [450, 400],
      "notes": "FUN√á√ÉO: Valida o payload recebido e prepara dados para roteamento.\n\nVALIDA√á√ïES:\n1. Campos obrigat√≥rios presentes (request_type, territory_id, dimension)\n2. Valores v√°lidos para request_type (analysis, data_collection, comparison)\n3. Valores v√°lidos para dimension (economic, social, territorial, environmental)\n\nOUTPUT:\n- Se v√°lido: Objeto estruturado com request_id, timestamp e dados validados\n- Se inv√°lido: Objeto de erro com mensagem e status 400\n\nPR√ìXIMO PASSO: Roteamento para workflow espec√≠fico baseado em request_type."
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict"
          },
          "conditions": [
            {
              "id": "route-analysis",
              "leftValue": "={{ $json.request_type }}",
              "rightValue": "analysis",
              "operator": {
                "type": "string",
                "operation": "equals"
              }
            },
            {
              "id": "route-data-collection",
              "leftValue": "={{ $json.request_type }}",
              "rightValue": "data_collection",
              "operator": {
                "type": "string",
                "operation": "equals"
              }
            },
            {
              "id": "route-comparison",
              "leftValue": "={{ $json.request_type }}",
              "rightValue": "comparison",
              "operator": {
                "type": "string",
                "operation": "equals"
              }
            }
          ],
          "combinator": "or"
        },
        "options": {}
      },
      "id": "switch-route-request",
      "name": "Rotear Requisi√ß√£o",
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3,
      "position": [650, 400],
      "notes": "FUN√á√ÉO: Roteia a requisi√ß√£o validada para o workflow apropriado.\n\nROTEAMENTO:\n- Output 0 (analysis): Envia para workflow de an√°lise dimensional\n- Output 1 (data_collection): Envia para workflow de coleta de dados\n- Output 2 (comparison): Envia para workflow de compara√ß√£o territorial\n- Output 3 (default): Requisi√ß√µes n√£o classificadas (erro)\n\nPR√ìXIMOS WORKFLOWS:\n- WF-ANALYSIS-DIMENSIONAL: Gera an√°lises por dimens√£o\n- WF-DATA-COLLECTOR: Coleta dados de APIs governamentais\n- WF-COMPARISON-TERRITORIAL: Compara m√∫ltiplos territ√≥rios"
    },
    {
      "parameters": {
        "jsCode": "// ============================================\n// FUN√á√ÉO: Processar requisi√ß√£o de an√°lise\n// ============================================\n\nconst request = $input.item.json;\n\n// Simular processamento de an√°lise (MVP)\nconst analysis_result = {\n  request_id: request.request_id,\n  status: 'processing',\n  message: 'üöÄ An√°lise em processamento',\n  territory: {\n    id: request.territory_id,\n    name: request.territory_name\n  },\n  dimension: request.dimension,\n  estimated_time: '30-60 segundos',\n  next_step: 'Aguarde enquanto os agentes especializados geram a an√°lise',\n  workflow: 'WF-ANALYSIS-DIMENSIONAL (a ser implementado)',\n  timestamp: new Date().toISOString()\n};\n\nreturn { json: analysis_result };"
      },
      "id": "code-process-analysis",
      "name": "Processar An√°lise",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [850, 300],
      "notes": "FUN√á√ÉO: Processa requisi√ß√µes de an√°lise dimensional.\n\nSTATUS ATUAL: MVP - Retorna resposta simulada\n\nFUTURO (Fase 9-10):\n- Chamar agente dimensional apropriado (ECON, SOCIAL, TERRA, AMBIENT)\n- Coletar dados do PostgreSQL\n- Gerar an√°lise com LLM\n- Inserir resultado no banco\n- Retornar an√°lise completa\n\nPOR ENQUANTO: Confirma recebimento e informa tempo estimado."
    },
    {
      "parameters": {
        "jsCode": "// ============================================\n// FUN√á√ÉO: Processar requisi√ß√£o de coleta de dados\n// ============================================\n\nconst request = $input.item.json;\n\nconst data_collection_result = {\n  request_id: request.request_id,\n  status: 'processing',\n  message: 'üìä Coleta de dados iniciada',\n  territory: {\n    id: request.territory_id,\n    name: request.territory_name\n  },\n  dimension: request.dimension,\n  estimated_time: '2-5 minutos',\n  next_step: 'Agente Data Collector est√° consultando APIs governamentais',\n  workflow: 'WF-DATA-COLLECTOR (a ser implementado)',\n  timestamp: new Date().toISOString()\n};\n\nreturn { json: data_collection_result };"
      },
      "id": "code-process-data-collection",
      "name": "Processar Coleta de Dados",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [850, 400],
      "notes": "FUN√á√ÉO: Processa requisi√ß√µes de coleta de dados.\n\nSTATUS ATUAL: MVP - Retorna resposta simulada\n\nFUTURO (Fase 10):\n- Chamar agente Data Collector\n- Consultar APIs: IBGE, INPE, DataSUS, etc.\n- Processar e normalizar dados\n- Inserir no PostgreSQL\n- Retornar confirma√ß√£o\n\nPOR ENQUANTO: Confirma recebimento e informa tempo estimado."
    },
    {
      "parameters": {
        "jsCode": "// ============================================\n// FUN√á√ÉO: Processar requisi√ß√£o de compara√ß√£o\n// ============================================\n\nconst request = $input.item.json;\n\nconst comparison_result = {\n  request_id: request.request_id,\n  status: 'processing',\n  message: 'üîÑ Compara√ß√£o territorial iniciada',\n  territory: {\n    id: request.territory_id,\n    name: request.territory_name\n  },\n  comparison_territories: request.parameters.comparison_territories || [],\n  dimension: request.dimension,\n  estimated_time: '45-90 segundos',\n  next_step: 'Agentes est√£o coletando dados de m√∫ltiplos territ√≥rios',\n  workflow: 'WF-COMPARISON-TERRITORIAL (a ser implementado)',\n  timestamp: new Date().toISOString()\n};\n\nreturn { json: comparison_result };"
      },
      "id": "code-process-comparison",
      "name": "Processar Compara√ß√£o",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [850, 500],
      "notes": "FUN√á√ÉO: Processa requisi√ß√µes de compara√ß√£o territorial.\n\nSTATUS ATUAL: MVP - Retorna resposta simulada\n\nFUTURO (Fase 11):\n- Coletar dados de m√∫ltiplos territ√≥rios\n- Normalizar indicadores\n- Gerar an√°lise comparativa com LLM\n- Criar visualiza√ß√µes\n- Retornar compara√ß√£o completa\n\nPOR ENQUANTO: Confirma recebimento e informa tempo estimado."
    },
    {
      "parameters": {
        "jsCode": "// ============================================\n// FUN√á√ÉO: Tratar erro de roteamento\n// ============================================\n\nconst request = $input.item.json;\n\nconst error_response = {\n  error: true,\n  message: '‚ùå Tipo de requisi√ß√£o n√£o reconhecido ou n√£o implementado',\n  request_id: request.request_id || 'unknown',\n  request_type: request.request_type || 'unknown',\n  status: 400,\n  timestamp: new Date().toISOString()\n};\n\nreturn { json: error_response };"
      },
      "id": "code-handle-error",
      "name": "Tratar Erro",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [850, 600],
      "notes": "FUN√á√ÉO: Trata requisi√ß√µes que n√£o foram roteadas corretamente.\n\nCEN√ÅRIOS:\n- request_type inv√°lido\n- Falha na valida√ß√£o\n- Workflow destino n√£o implementado\n\nOUTPUT: Mensagem de erro estruturada com status 400."
    },
    {
      "parameters": {
        "respondWith": "json",
        "responseBody": "={{ $json }}",
        "options": {
          "responseCode": "={{ $json.status || 200 }}",
          "responseHeaders": {
            "entries": [
              {
                "name": "Content-Type",
                "value": "application/json"
              },
              {
                "name": "Access-Control-Allow-Origin",
                "value": "*"
              },
              {
                "name": "Access-Control-Allow-Methods",
                "value": "POST, OPTIONS"
              },
              {
                "name": "Access-Control-Allow-Headers",
                "value": "Content-Type, Authorization"
              }
            ]
          }
        }
      },
      "id": "respond-to-webhook",
      "name": "Responder ao Dashboard",
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.1,
      "position": [1050, 400],
      "notes": "FUN√á√ÉO: Envia resposta HTTP de volta ao dashboard.\n\nCONFIGURA√á√ÉO:\n- Formato: JSON\n- Headers CORS: Permite requisi√ß√µes do Replit\n- Status Code: Din√¢mico (200 para sucesso, 400 para erro)\n\nRESPOSTA: JSON com status da requisi√ß√£o e pr√≥ximos passos."
    }
  ],
  "connections": {
    "Webhook - Recebe Requisi√ß√£o": {
      "main": [
        [
          {
            "node": "Validar Requisi√ß√£o",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Validar Requisi√ß√£o": {
      "main": [
        [
          {
            "node": "Rotear Requisi√ß√£o",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Rotear Requisi√ß√£o": {
      "main": [
        [
          {
            "node": "Processar An√°lise",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Processar Coleta de Dados",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Processar Compara√ß√£o",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Tratar Erro",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Processar An√°lise": {
      "main": [
        [
          {
            "node": "Responder ao Dashboard",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Processar Coleta de Dados": {
      "main": [
        [
          {
            "node": "Responder ao Dashboard",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Processar Compara√ß√£o": {
      "main": [
        [
          {
            "node": "Responder ao Dashboard",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Tratar Erro": {
      "main": [
        [
          {
            "node": "Responder ao Dashboard",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "pinData": {},
  "settings": {
    "executionOrder": "v1"
  },
  "staticData": null,
  "tags": [
    {
      "name": "Framework V6.0",
      "id": "framework-v6"
    },
    {
      "name": "Webhook",
      "id": "webhook"
    },
    {
      "name": "Receptor",
      "id": "receptor"
    }
  ],
  "meta": {
    "instanceId": "galactic-ai"
  },
  "triggerCount": 0,
  "updatedAt": "2025-11-16T00:00:00.000Z",
  "versionId": "1.0.0"
}
