================================================================================
AN√ÅLISE DETALHADA DO WORKFLOW: AGENTE ECON V2
================================================================================

üìã Nome: WF-AGENT-ECON - Especialista Econ√¥mico V2
üìä Total de N√≥s: 10
üîó Total de Conex√µes: 8

================================================================================
AN√ÅLISE DOS N√ìS
================================================================================

1. Webhook - Recebe Tarefa
   Tipo: n8n-nodes-base.webhook
   Fun√ß√£o: FUN√á√ÉO: Ponto de entrada do Agente ECON.
   Par√¢metros:
      - method: POST
      - path: agent-econ
      - response_mode: responseNode
   Tratamento de Erro: stopWorkflow

2. Consultar Dados PostgreSQL
   Tipo: n8n-nodes-base.postgres
   Fun√ß√£o: FUN√á√ÉO: Buscar todos os dados econ√¥micos do territ√≥rio no banco de dados.
   Par√¢metros:
      - operation: executeQuery
      - has_query: True
      - query_preview: SELECT 
  t.id AS territory_id,
  t.name AS territory_name,
  t.type AS territory_type,
  t.area AS ...
   Credenciais: ['postgres']
   Tratamento de Erro: continueErrorOutput

3. Preparar Contexto para LLM
   Tipo: n8n-nodes-base.code
   Fun√ß√£o: FUN√á√ÉO: Processar dados brutos do PostgreSQL e construir prompt estruturado para o LLM.
   Par√¢metros:
      - has_code: True
      - code_lines: 174
      - code_preview: // ============================================================================
// N√ì: PREPARAR CONT...
   Tratamento de Erro: stopWorkflow

4. Gerar An√°lise com OpenAI
   Tipo: @n8n/n8n-nodes-langchain.openAi
   Fun√ß√£o: FUN√á√ÉO: Gerar an√°lise econ√¥mica usando LLM da OpenAI.
   Par√¢metros:
      - model: gpt-4o-mini
      - has_messages: True
   Credenciais: ['openAiApi']
   Tratamento de Erro: continueErrorOutput

5. Estruturar Resposta
   Tipo: n8n-nodes-base.code
   Fun√ß√£o: FUN√á√ÉO: Consolidar an√°lise do LLM com metadados em resposta estruturada.
   Par√¢metros:
      - has_code: True
      - code_lines: 66
      - code_preview: // ========================================
// ESTRUTURAR RESPOSTA FINAL
// ========================...
   Tratamento de Erro: stopWorkflow

6. Salvar An√°lise no PostgreSQL
   Tipo: n8n-nodes-base.postgres
   Fun√ß√£o: FUN√á√ÉO: Salvar an√°lise gerada na tabela 'knowledge_base' do PostgreSQL.
   Par√¢metros:
      - operation: executeQuery
      - has_query: True
      - query_preview: INSERT INTO knowledge_base (
  territory_id,
  dimension,
  content,
  summary,
  confidence_score,
...
   Credenciais: ['postgres']
   Tratamento de Erro: continueErrorOutput

7. Respond to Webhook
   Tipo: n8n-nodes-base.respondToWebhook
   Fun√ß√£o: 
   Tratamento de Erro: continueRegularOutput

8. Responder Erro
   Tipo: n8n-nodes-base.respondToWebhook
   Fun√ß√£o: 
   Tratamento de Erro: continueRegularOutput

9. Preparar Dados para Salvar
   Tipo: n8n-nodes-base.code
   Fun√ß√£o: 
   Par√¢metros:
      - has_code: True
      - code_lines: 38
      - code_preview: // --- In√≠cio do C√≥digo Corrigido ---

// Pega os dados do n√≥ "Estruturar Resposta" (n√≥ anterior)
co...
   Tratamento de Erro: continueErrorOutput

10. Preparar Resposta do Webhook
   Tipo: n8n-nodes-base.code
   Fun√ß√£o: 
   Par√¢metros:
      - has_code: True
      - code_lines: 112
      - code_preview: // ============================================================================
// N√ì: PREPARAR RESP...
   Tratamento de Erro: stopWorkflow

================================================================================
FLUXO DE EXECU√á√ÉO
================================================================================

üì• Pontos de Entrada: Webhook - Recebe Tarefa
üì§ Pontos de Sa√≠da: Respond to Webhook, Responder Erro

Mapa de Fluxo:
  Webhook - Recebe Tarefa ‚Üí
    [main] ‚Üí [{'node': 'Consultar Dados PostgreSQL', 'type': 'main', 'index': 0}]
  Consultar Dados PostgreSQL ‚Üí
    [main] ‚Üí [{'node': 'Preparar Contexto para LLM', 'type': 'main', 'index': 0}], [{'node': 'Responder Erro', 'type': 'main', 'index': 0}]
  Preparar Contexto para LLM ‚Üí
    [main] ‚Üí [{'node': 'Gerar An√°lise com OpenAI', 'type': 'main', 'index': 0}]
  Gerar An√°lise com OpenAI ‚Üí
    [main] ‚Üí [{'node': 'Estruturar Resposta', 'type': 'main', 'index': 0}], [{'node': 'Responder Erro', 'type': 'main', 'index': 0}]
  Estruturar Resposta ‚Üí
    [main] ‚Üí [{'node': 'Preparar Dados para Salvar', 'type': 'main', 'index': 0}]
  Salvar An√°lise no PostgreSQL ‚Üí
    [main] ‚Üí [{'node': 'Preparar Resposta do Webhook', 'type': 'main', 'index': 0}], [{'node': 'Responder Erro', 'type': 'main', 'index': 0}]
  Preparar Dados para Salvar ‚Üí
    [main] ‚Üí [{'node': 'Salvar An√°lise no PostgreSQL', 'type': 'main', 'index': 0}], [{'node': 'Responder Erro', 'type': 'main', 'index': 0}]
  Preparar Resposta do Webhook ‚Üí
    [main] ‚Üí [{'node': 'Respond to Webhook', 'type': 'main', 'index': 0}]

================================================================================
INTERA√á√ïES COM BANCO DE DADOS
================================================================================

üìñ Opera√ß√µes de Leitura: 1
   - Consultar Dados PostgreSQL: territories, t, ei

‚úçÔ∏è  Opera√ß√µes de Escrita: 1
   - Salvar An√°lise no PostgreSQL: knowledge_base

üóÑÔ∏è  Tabelas Acessadas: knowledge_base, t, ei, territories
